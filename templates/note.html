<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>TMPNOTES üî•Ô∏è</title>

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Custom styles for this template -->
    <link href="/custom.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"
        integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body class="py-4">
    <div class="container">

        <h1><a href="/" style="text-decoration: none; color: inherit;">TMPNOTES üî•Ô∏è</a></h1>
        <p class="lead">Temporary notes that disappear after reading</p>

        <h2>Note:</h2>
        <div class="row">
            <div class="col-lg-9">
                <textarea class="form-control" id="note" rows="7" readonly>{{ .Message }}</textarea>
            </div>
            <div class="col">
                <div class="row">
                    <br>
                    <button type="submit" class="btn btn-primary mb-2 btn-block mt-1" onclick="copyNote()">Copy</button>
                </div>
            </div>
        </div>
        <div class="row" id="decrypt-row">
            <div class="col-lg-9">
                <div id="dec-input" class="form-group" style="visibility: hidden;">
                    <label for="dec-key">Decryption key</label>
                    <input type="password" class="form-control" id="dec-key" placeholder="Your passphrase here">
                </div>
            </div>
            <div class="col">
                <div class="row">
                    <p></p>
                    <br>
                    <button id="dec-button" type="submit" class="btn btn-primary mb-2 btn-block mt-1"
                        onclick="decryptNote()" style="visibility: hidden;">Decrypt</button>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col">
                üî•Ô∏è It's gone! Now that this has been read, you will not be able to see this note again. üî•Ô∏è
            </div>
        </div>
    </div>
</body>

</html>

<script>
    checkDecryptionRequired()

    function copyNote() {
        let textarea = document.getElementById("note");
        textarea.select();
        document.execCommand("copy");
    }

    function checkDecryptionRequired() {
        note = document.getElementById("note");
        if (note.value.startsWith("[ENC]")) {
            e = document.getElementById("dec-button");
            e.style.visibility = "visible";
            e = document.getElementById("dec-input");
            e.style.visibility = "visible";
        } else {
            document.getElementById("decrypt-row").remove()
        }
    }

    function decryptNote() {
        note = document.getElementById("note");
        notetext = note.value.replace("[ENC]", "");
        key = document.getElementById("dec-key").value;

        try {
            var bytes = CryptoJS.AES.decrypt(notetext, key);
            var res = bytes.toString(CryptoJS.enc.Utf8);

            if (res != "") {
                note.value = res
                document.getElementById("decrypt-row").remove()
            } else {
                alert("Decryption failed")
            }
        } catch (error) {
            console.error(error);
            alert("Decryption failed")
        }
    }
</script>